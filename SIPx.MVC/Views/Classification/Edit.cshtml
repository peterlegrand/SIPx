@using Syncfusion.EJ2
@using Newtonsoft.Json
@model ClassificationUpdateGet
@{
    var Term = (List<UITermLanguageCustomizationList>)ViewBag.UITerms;
    var ErrorMessages = (List<ErrorMessage>)ViewBag.ErrorMessages;
    ViewData["Title"] = @Term.Find(x => x.InternalName.Equals("Classification")).TermString;

    Layout = "_LayoutAdmin";
}

<h1>
    <img src="~/images/icons/Classification.png" width="50" height="50" />@Term.Find(x => x.InternalName.Equals("Classification")).TermString
</h1>
<div class="container">

    <form method="post">
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Id")).TermString ClassificationId
            </div>
            <div class="col-9">
                <ejs-numerictextbox id="ClassificationId" ejs-for="@Model.ClassificationId" cssClass="e-outline" placeholder="ClassificationId" floatLabelType="Auto"></ejs-numerictextbox>
            </div>
        </div>

        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Name")).TermString
            </div>    <div class="col-9">
                <ejs-textbox id="Name" ejs-for="Name" cssClass="e-outline" placeholder="Name" floatLabelType="Auto"></ejs-textbox>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 5))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 5).Name
                </div>
            </div>
        }
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 104))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 104).Name
                </div>
            </div>
        }
        @*<div class="row">
            <div class="col-3">@Term.Find(x => x.InternalName.Equals("Description")).TermString</div>
            <div class="col-9">
                <div class="row  e-rte-custom-tbar-section">
                    <div class="control-wrapper" id="rteSection">
                        <div class="control-section">
                            <ejs-richtexteditor ejs-for="Description" id="customtool" created="onCreate">
                                <e-content-template>
                                </e-content-template>
                                <e-richtexteditor-toolbarsettings items="@ViewBag.items">
                                </e-richtexteditor-toolbarsettings>
                            </ejs-richtexteditor>
                        </div>
                        <div id="customTbarDialog" style="display: none">
                            <div id="file-uploader">
                                <ejs-uploader id="UploadFiles" success="onSuccess" allowedExtensions=".png, .jpeg, .jpg">
                                    <e-uploader-asyncsettings saveUrl="@Url.Content("~/Classification/SaveFile")" removeUrl="https://aspnetmvc.syncfusion.com/services/api/uploadbox/Remove"></e-uploader-asyncsettings>
                                </ejs-uploader>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 9))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 9).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Menu name")).TermString
            </div>
            <div class="col-9">
                <ejs-textbox id="MenuName" ejs-for="MenuName" cssClass="e-outline" placeholder="Menu name" floatLabelType="Auto"></ejs-textbox>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 10))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 10).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Mouse over")).TermString
            </div>
            <div class="col-9">
                <ejs-textbox id="MouseOver" ejs-for="MouseOver" cssClass="e-outline" placeholder="Mouse over" floatLabelType="Auto"></ejs-textbox>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 11))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 11).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Has dropdown")).TermString
            </div>
            <div class="col-9">
                <ejs-checkbox id="HasDropDown" label="Dropdown" ejs-for="HasDropDown" checked="@Model.HasDropDown"></ejs-checkbox>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 2))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 2).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Dropdown sequence")).TermString
            </div>
            <div class="col-9">
                <ejs-dropdownlist id="Sequence" dataSource="@Model.DropDownSequences" ejs-for="@Model.DropDownSequence" value="@Model.DropDownSequence" popupHeight="220px">
                    <e-dropdownlist-fields text="Name" value="Sequence"></e-dropdownlist-fields>
                </ejs-dropdownlist>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 3))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 3).Name
                </div>
            </div>
        }
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 4))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 4).Name
                </div>
            </div>
        }
        @*<div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Default page")).TermString
            </div>
            <div class="col-9">
                <ejs-dropdownlist id="DefaultPage" dataSource="@Model.DefaultPages" ejs-for="@Model.DefaultPageId" value="@Model.DefaultPageId" index="2" filtering="FilterDefaultPage" popupHeight="220px">
                    <e-dropdownlist-fields text="Name" value="ClassificationPageId"></e-dropdownlist-fields>
                </ejs-dropdownlist>

            </div>
        </div>*@
        @*<ejs-richtexteditor ejs-for="Description" id="defaultRTE" showCharCount="true" actionBegin="handleFullScreen" actionComplete="actionCompleteHandler" maxLength="2000" created="created">
            <e-content-template>
            </e-content-template>
            <e-richtexteditor-toolbarsettings items="@ViewBag.tools">
            </e-richtexteditor-toolbarsettings>
        </ejs-richtexteditor>*@

        <textarea asp-for="@Model.Description" class="form-control ckeditor" id="descriptionx" name="Description"></textarea>
        @* PETER TODO need to do error message on default page. *@
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Status")).TermString
            </div>
            <div class="col-9">
                <ejs-dropdownlist id="Status" dataSource="@Model.Statuses" ejs-for="@Model.StatusId" value="@Model.StatusId" popupHeight="220px">
                    <e-dropdownlist-fields text="Name" value="StatusId"></e-dropdownlist-fields>
                </ejs-dropdownlist>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 1))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 1).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Icon")).TermString
            </div>
            <div class="col-9">
                <ejs-dropdownlist id="IconId" dataSource="@Model.Icons" ejs-for="@Model.IconId" value="@Model.IconId" popupHeight="220px">
                    <e-dropdownlist-fields text="Name" value="IconId"></e-dropdownlist-fields>
                </ejs-dropdownlist>
            </div>
        </div>
        @if (ErrorMessages.Exists(x => x.ErrorMessageId == 8))
        {
            <div class="row">
                <div class="offset-3 col-9 alert-danger">
                    @ErrorMessages.Find(x => x.ErrorMessageId == 8).Name
                </div>
            </div>
        }
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Color")).TermString
            </div>
            <div class="col-9">
                <ejs-colorpicker id='color-picker' ejs-for="Color" value="Color"></ejs-colorpicker>
            </div>
        </div>
        <div class="row">
            <div class="col-3 offset-3">
                <ejs-button id="primarybtn" content="@Term.Find(x => x.InternalName.Equals("Save")).TermString" action="Submit" isPrimary="true"></ejs-button>
                <a asp-action="Index">@Term.Find(x => x.InternalName.Equals("Cancel")).TermString</a>
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Creator")).TermString
            </div>
            <div class="col-9">
                @Model.CreatorName
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Created date")).TermString
            </div>
            <div class="col-9">
                @Model.CreatedDate
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Modifier")).TermString
            </div>
            <div class="col-9">
                @Model.ModifierName
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                @Term.Find(x => x.InternalName.Equals("Modified date")).TermString
            </div>
            <div class="col-9">
                <div>@Model.ModifiedDate</div>
            </div>
        </div>

    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/mode/css/css.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/mode/xml/xml.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/mode/htmlmixed/htmlmixed.js" type="text/javascript"></script>
<style>
    .e-code-mirror::before {
        content: '\e345';
    }

    .e-html-preview::before {
        content: '\e350';
    }

    .CodeMirror-linenumber,
    .CodeMirror-gutters {
        display: none;
    }

    .sb-header {
        z-index: 100;
    }

    .sb-content.e-view.hide-header {
        top: 0 !important;
    }

    .sb-header.e-view.hide-header {
        display: none;
    }

    .e-richtexteditor .e-rte-content .e-content pre {
        padding: 10px;
        background: #F4F5F7;
    }

    .highcontrast .e-richtexteditor .e-rte-content .e-content pre {
        padding: 10px;
        background: #303030;
    }
</style>

<script type="text/javascript">
    var rteObj, myCodeMirror, textArea;
    function created() {
        rteObj = this;
        textArea = rteObj.contentModule.getEditPanel();
    }
    function mirrorConversion(e) {
        var id = rteObj.getID() + 'mirror-view';
        var mirrorView = rteObj.element.querySelector('#' + id);
        var charCount = rteObj.element.querySelector('.e-rte-character-count');
        if (e.targetItem === 'Preview') {
            textArea.style.display = 'block';
            mirrorView.style.display = 'none';
            textArea.innerHTML = myCodeMirror.getValue();
            charCount.style.display = 'block';
        }
        else {
            if (!mirrorView) {
                mirrorView = ej.base.createElement('div', { className: 'e-content' });
                mirrorView.id = id;
                textArea.parentNode.appendChild(mirrorView);
            }
            else {
                mirrorView.innerHTML = '';
            }
            textArea.style.display = 'none';
            mirrorView.style.display = 'block';
            renderCodeMirror(mirrorView, defaultRTE.value);
            charCount.style.display = 'none';
        }
    }
    function renderCodeMirror(mirrorView, content) {
        myCodeMirror = CodeMirror(mirrorView, {
            value: content,
            lineNumbers: true,
            mode: 'text/html',
            lineWrapping: true,
        });
    }
    function handleFullScreen(e) {
        var sbCntEle = document.querySelector('.sb-content.e-view');
        var sbHdrEle = document.querySelector('.sb-header.e-view');
        if (e.targetItem === 'Maximize') {
            if (ej.base.Browser.isDevice && ej.base.Browser.isIos) {
                ej.base.addClass([sbCntEle, sbHdrEle], ['hide-header']);
            }
        }
        else if (e.targetItem === 'Minimize') {
            if (ej.base.Browser.isDevice && ej.base.Browser.isIos) {
                ej.base.removeClass([sbCntEle, sbHdrEle], ['hide-header']);
            }
        }
    }
    function actionCompleteHandler(e) {
        if (e.targetItem && (e.targetItem === 'SourceCode' || e.targetItem === 'Preview')) {
            this.sourceCodeModule.getPanel().style.display = 'none';
            mirrorConversion(e);
        }
        else {
            setTimeout(function () { rteObj.toolbarModule.refreshToolbarOverflow(); }, 400);
        }
    }
</script>
<script type="text/javascript">
        function FilterDefaultPage(e) {
                    var query = new ej.data.Query();
                    query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
                    e.updateData(@Html.Raw(JsonConvert.SerializeObject(Model.DefaultPages)), query);
                }
</script>
<script type="text/javascript">
        function FilterStatus(e) {
                    var query = new ej.data.Query();
                    query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
                    e.updateData(@Html.Raw(JsonConvert.SerializeObject(Model.DefaultPages)), query);
                }
</script>
<script>
    var defaultRTE, ranges, selection = new ej.richtexteditor.NodeSelection();
    var defaultDialog;

    function onCreate() {
        defaultRTE = this;
        var customBtn = defaultRTE.element.querySelector('#custom_tbar');

        // Initialization of Dialog
        var dialog = new ej.popups.Dialog({
            header: 'Select Multiple Image file to upload',
            target: document.getElementById('rteSection'),
            showCloseIcon: false,
            isModal: true,
            created: function () {
                defaultDialog = this;
            },
            visible: false,
            height: 'auto',
            showCloseIcon: true
        });
        // Render initialized Dialog
        dialog.appendTo('#customTbarDialog');

        customBtn.onclick = function (e) {
            dialog.element.style.display = '';
            ranges = selection.getRange(document);
            dialog.width = defaultRTE.element.offsetWidth * 0.5;
            dialog.dataBind();
            dialog.show();
            customBtn.onclick = function (e) {
                defaultRTE.focusIn();
                dialog.element.style.display = '';
                ranges = selection.getRange(document);
                dialog.width = defaultRTE.element.offsetWidth * 0.5;
                dialog.dataBind();
                dialog.show();
            };
        };
    }

    function onSuccess(args) {
        //Replace the image saved URL location here
        defaultRTE.executeCommand('insertImage', { url: '/images/' + args.file.name });
        defaultDialog.hide();
    }
</script>
<script>
    $(document).ready(function () {
        if (CKEDITOR.instances['descriptionx']) {
            CKEDITOR.instances['descriptionx'].destroy();
        }
        CKEDITOR.replace('descriptionx', {
            fullPage: false, uiColor: '#efe8ce'
        });
        $('#getVal').on('click', function (e) {
            let ckValue = CKEDITOR.instances['descriptionx'].getData()
            console.log(ckValue);
        });
    });
</script>